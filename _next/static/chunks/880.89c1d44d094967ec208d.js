"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[880],{45263:function(t,e,n){n.d(e,{aK:function(){return We},dV:function(){return at},Qr:function(){return Sn},ii:function(){return r},JF:function(){return wt},qB:function(){return sn},_C:function(){return In}});var r={};n.r(r),n.d(r,{AnchorPosition:function(){return K},DrawBox:function(){return rt},DrawBoxOptions:function(){return nt},DrawFaceLandmarks:function(){return Jt},DrawFaceLandmarksOptions:function(){return $t},DrawTextField:function(){return et},DrawTextFieldOptions:function(){return tt},drawContour:function(){return i},drawDetections:function(){return ot},drawFaceExpressions:function(){return Yt},drawFaceLandmarks:function(){return Kt}});var o=n(75);function i(t,e,n){if(void 0===n&&(n=!1),t.beginPath(),e.slice(1).forEach((function(n,r){var o=n.x,i=n.y,a=e[r];t.moveTo(a.x,a.y),t.lineTo(o,i)})),n){var r=e[e.length-1],o=e[0];if(!r||!o)return;t.moveTo(r.x,r.y),t.lineTo(o.x,o.y)}t.stroke()}var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function c(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var s=function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function u(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(e){i(e)}}function c(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))}function h(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(c){i=[6,c],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}function f(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)r[o]=i[a];return r}var p=function(){function t(t,e){if(!y(t)||!y(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function l(t,e){return t instanceof o.esB&&t.shape.length===e}function d(t){return l(t,3)}function v(t){return l(t,4)}function m(t){return t%2===0}function g(t,e){void 0===e&&(e=2);var n=Math.pow(10,e);return Math.floor(t*n)/n}function b(t){return t&&t.width&&t.height}function _(t){return t.reduce((function(t,e){return t.add(e)}),new P(0,0)).div(new P(t.length,t.length))}function w(t,e,n){return Array(t).fill(0).map((function(t,r){return e+r*n}))}function y(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function x(t){return y(t)&&0<=t&&t<=1}var P=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),E=function(){function t(e,n){void 0===n&&(n=!0);var r=e||{},o=[r.left,r.top,r.right,r.bottom].every(y),i=[r.x,r.y,r.width,r.height].every(y);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],c=a[0],s=a[1],u=a[2],h=a[3];t.assertIsValidBox({x:c,y:s,width:u,height:h},"Box.constructor",n),this._x=c,this._y=s,this._width=u,this._height=h}return t.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(y)},t.assertIsValidBox=function(e,n,r){if(void 0===r&&(r=!1),!t.isRect(e))throw new Error(n+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(n+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new P(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new P(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new P(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new P(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map((function(t){return Math.round(t)}));return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map((function(t){return Math.floor(t)}));return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.toSquare=function(){var e=this,n=e.x,r=e.y,o=e.width,i=e.height,a=Math.abs(o-i);return o<i&&(n-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new t({x:n,y:r,width:o,height:i})},t.prototype.rescale=function(e){var n=b(e)?e.width:e,r=b(e)?e.height:e;return new t({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},t.prototype.pad=function(e,n){var r=[this.x-e/2,this.y-n/2,this.width+e,this.height+n];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(e,n){var r=this,o=r.x,i=r.y,a=r.right,c=r.bottom,s=Math.max(o,0),u=Math.max(i,0),h=a-s,f=c-u;return new t({x:s,y:u,width:Math.min(h,e-s),height:Math.min(f,n-u)}).floor()},t.prototype.shift=function(e,n){var r=this.width,o=this.height;return new t({x:this.x+e,y:this.y+n,width:r,height:o})},t.prototype.padAtBorders=function(t,e){var n=this.width+1,r=this.height+1,o=n,i=r,a=this.left,c=this.top,s=this.right,u=this.bottom;return s>e&&(o=-s+e+n,s=e),u>t&&(i=-u+t+r,u=t),a<1&&(i=2-a,a=1),c<1&&(i=2-c,c=1),{dy:1,edy:i,dx:1,edx:o,y:c,ey:u,x:a,ex:s,w:n,h:r}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),F=function(t){function e(e,n,r,o,i){return void 0===i&&(i=!1),t.call(this,{left:e,top:n,right:r,bottom:o},i)||this}return c(e,t),e}(E),M=function(){function t(t,e,n,r,o){this._imageDims=new p(o.width,o.height),this._score=t,this._classScore=e,this._className=n,this._box=new E(r).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new E(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:n})},t}(),D=function(t){function e(e,n,r){return t.call(this,e,e,"",n,r)||this}return c(e,t),e.prototype.forSize=function(n,r){var o=t.prototype.forSize.call(this,n,r);return new e(o.score,o.relativeBox,o.imageDims)},e}(M);function S(t,e,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left))*Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top));return n?r/(t.area+e.area-r):r/Math.min(t.area,e.area)}function I(t,e,n,r){void 0===r&&(r=!0);for(var o=e.map((function(t,e){return{score:t,boxIndex:e}})).sort((function(t,e){return t.score-e.score})).map((function(t){return t.boxIndex})),i=[],a=function(){var e=o.pop();i.push(e);for(var a=o,c=[],s=0;s<a.length;s++){var u=a[s],h=t[e],f=t[u];c.push(S(h,f,r))}o=o.filter((function(t,e){return c[e]<=n}))};o.length>0;)a();return i}function T(t,e){return o.lub((function(){var n=e[0],r=e[1],i=e[2],a=o.hlL(f(t.shape.slice(0,3),[1]),n),c=o.hlL(f(t.shape.slice(0,3),[1]),r),s=o.hlL(f(t.shape.slice(0,3),[1]),i),u=o.zoF([a,c,s],3);return o.luU(t,u)}))}function C(t){return 1/(1+Math.exp(-t))}var O=function(t){function e(e,n,r,o,i){return void 0===i&&(i=!1),t.call(this,{x:e,y:n,width:r,height:o},i)||this}return c(e,t),e}(E),B=function(){function t(t,e,n){void 0===n&&(n=new P(0,0));var r=e.width,o=e.height;this._imgDims=new p(r,o),this._shift=n,this._positions=t.map((function(t){return t.mul(new P(r,o)).add(n)}))}return Object.defineProperty(t.prototype,"shift",{get:function(){return new P(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map((function(e){return e.sub(t._shift).div(new P(t.imageWidth,t.imageHeight))}))},enumerable:!0,configurable:!0}),t.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},t.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new P(t,e))},t.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},t.prototype.align=function(t,e){if(void 0===e&&(e={}),t){var n=t instanceof D?t.box.floor():new E(t);return this.shiftBy(n.x,n.y).align(null,e)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),o=r.useDlibAlignment,i=r.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(i)},t.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],n=t[1],r=t[2],o=function(t){return r.sub(t).magnitude()},i=(o(e)+o(n))/2,a=Math.floor(i/.45),c=_(t),s=Math.floor(Math.max(0,c.x-.5*a)),u=Math.floor(Math.max(0,c.y-.43*a));return new O(s,u,Math.min(a,this.imageWidth+s),Math.min(a,this.imageHeight+u))},t.prototype.alignMinBbox=function(t){var e=function(t){var e=t.map((function(t){return t.x})),n=t.map((function(t){return t.y})),r=e.reduce((function(t,e){return e<t?e:t}),1/0),o=n.reduce((function(t,e){return e<t?e:t}),1/0),i=e.reduce((function(t,e){return t<e?e:t}),0),a=n.reduce((function(t,e){return t<e?e:t}),0);return new F(r,o,i,a)}(this.positions);return e.pad(e.width*t,e.height*t)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],_([t[3],t[4]])]},e}(B),A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(_)},e}(B),L=function(){function t(t,e){this._label=t,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){return void 0===t&&(t=!0),this.label+(t?" ("+g(this.distance)+")":"")},t}(),j=function(t){function e(e,n){var r=t.call(this,e)||this;return r._label=n,r}return c(e,t),e.assertIsValidLabeledBox=function(t,e){if(E.assertIsValidBox(t,e),!y(t.label))throw new Error(e+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(E),R=function(){function t(t,e){if("string"!==typeof t)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some((function(t){return!(t instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map((function(t){return Array.from(t)}))}},t.fromJSON=function(e){var n=e.descriptors.map((function(t){return new Float32Array(t)}));return new t(e.label,n)},t}();!function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i._score=r,i._classScore=o,i}c(e,t),e.assertIsValidPredictedBox=function(t,e){if(j.assertIsValidLabeledBox(t,e),!x(t.score)||!x(t.classScore))throw new Error(e+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(j);function N(t){return t.detection instanceof D}function H(t,e){var n={detection:e};return Object.assign({},t,n)}function W(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function z(t){var e="";if(!t)try{t=n(68730)}catch(r){e=r.toString()}return{readFile:t?function(e){return new Promise((function(n,r){t.readFile(e,(function(t,e){return t?r(t):n(e)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}function U(){var t=n.g.Canvas||n.g.HTMLCanvasElement,e=n.g.Image||n.g.HTMLImageElement,r=n.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=z();return s({Canvas:t||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:e||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:r},o)}function X(){return"object"===typeof window&&"undefined"!==typeof document&&"undefined"!==typeof HTMLImageElement&&"undefined"!==typeof HTMLCanvasElement&&"undefined"!==typeof HTMLVideoElement&&"undefined"!==typeof ImageData&&"undefined"!==typeof CanvasRenderingContext2D}var Y,G=n(34155);function V(){return"object"===typeof n.g&&"undefined"!==typeof G&&!!G.version}function $(t){Y=t}function J(){X()&&$(W()),V()&&$(U())}var K,Q={getEnv:function(){if(!Y)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Y},setEnv:$,initialize:J,createBrowserEnv:W,createFileSystem:z,createNodejsEnv:U,monkeyPatch:function(t){if(Y||J(),!Y)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=t.Canvas,n=void 0===e?Y.Canvas:e,r=t.Image,o=void 0===r?Y.Image:r;Y.Canvas=n,Y.Image=o,Y.createCanvasElement=t.createCanvasElement||function(){return new n},Y.createImageElement=t.createImageElement||function(){return new o},Y.ImageData=t.ImageData||Y.ImageData,Y.Video=t.Video||Y.Video,Y.fetch=t.fetch||Y.fetch,Y.readFile=t.readFile||Y.readFile},isBrowser:X,isNodejs:V};function q(t){return Q.isNodejs()||"string"!==typeof t?t:document.getElementById(t)}function Z(t){var e=Q.getEnv(),n=e.Canvas;if(t instanceof e.CanvasRenderingContext2D)return t;var r=q(t);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=r.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}J(),function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"}(K||(K={}));var tt=function(t){void 0===t&&(t={});var e=t.anchorPosition,n=t.backgroundColor,r=t.fontColor,o=t.fontSize,i=t.fontStyle,a=t.padding;this.anchorPosition=e||K.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=i||"Georgia",this.padding=a||4},et=function(){function t(e,n,r){void 0===r&&(r={}),this.text="string"===typeof e?[e]:e instanceof t?e.text:e,this.anchor=n,this.options=new tt(r)}return t.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map((function(e){return t.measureText(e).width})).reduce((function(t,e){return t<e?e:t}),0)+2*e},t.prototype.measureHeight=function(){var t=this.options,e=t.fontSize,n=t.padding;return this.text.length*e+2*n},t.prototype.getUpperLeft=function(t,e){var n=this.options.anchorPosition,r=n===K.BOTTOM_RIGHT||n===K.TOP_RIGHT,o=n===K.BOTTOM_LEFT||n===K.BOTTOM_RIGHT,i=this.measureWidth(t),a=this.measureHeight(),c=r?this.anchor.x-i:this.anchor.x,s=o?this.anchor.y-a:this.anchor.y;if(e){var u=e.width,h=e.height;return{x:Math.max(Math.min(c,u-i),0),y:Math.max(Math.min(s,h-a),0)}}return{x:c,y:s}},t.prototype.draw=function(t){var e=q(t),n=Z(e),r=this.options,o=r.backgroundColor,i=r.fontColor,a=r.fontSize,c=r.fontStyle,s=r.padding;n.font=a+"px "+c;var u=this.measureWidth(n),h=this.measureHeight();n.fillStyle=o;var f=this.getUpperLeft(n,e);n.fillRect(f.x,f.y,u,h),n.fillStyle=i,this.text.forEach((function(t,e){var r=s+f.x,o=s+f.y+(e+1)*a;n.fillText(t,r,o)}))},t}(),nt=function(t){void 0===t&&(t={});var e=t.boxColor,n=t.lineWidth,r=t.label,o=t.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var i={anchorPosition:K.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new tt(Object.assign({},i,o))},rt=function(){function t(t,e){void 0===e&&(e={}),this.box=new E(t),this.options=new nt(e)}return t.prototype.draw=function(t){var e=Z(t),n=this.options,r=n.boxColor,o=n.lineWidth,i=this.box,a=i.x,c=i.y,s=i.width,u=i.height;e.strokeStyle=r,e.lineWidth=o,e.strokeRect(a,c,s,u);var h=this.options.label;h&&new et([h],{x:a-o/2,y:c},this.options.drawLabelOptions).draw(t)},t}();function ot(t,e){(Array.isArray(e)?e:[e]).forEach((function(e){var n=e instanceof D?e.score:N(e)?e.detection.score:void 0,r=e instanceof D?e.box:N(e)?e.detection.box:new E(e),o=n?""+g(n):void 0;new rt(r,{label:o}).draw(t)}))}function it(t){var e=Q.getEnv(),n=e.Image,r=e.Video;return t instanceof n&&t.complete||t instanceof r&&t.readyState>=3}function at(t){return new Promise((function(e,n){if(!(t instanceof Blob))return n("bufferToImage - expected buf to be of type: Blob");var r=new FileReader;r.onload=function(){if("string"!==typeof r.result)return n("bufferToImage - expected reader.result to be a string, in onload");var t=Q.getEnv().createImageElement();t.onload=function(){return e(t)},t.onerror=n,t.src=r.result},r.onerror=n,r.readAsDataURL(t)}))}function ct(t){var e=Q.getEnv(),n=e.Image,r=e.Video;return t instanceof n?new p(t.naturalWidth,t.naturalHeight):t instanceof r?new p(t.videoWidth,t.videoHeight):new p(t.width,t.height)}function st(t){var e=t.width,n=t.height,r=(0,Q.getEnv().createCanvasElement)();return r.width=e,r.height=n,r}function ut(t,e){var n=Q.getEnv().ImageData;if(!(t instanceof n)&&!it(t))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=e||ct(t),o=r.width,i=r.height,a=st({width:o,height:i});return t instanceof n?Z(a).putImageData(t,0,0):Z(a).drawImage(t,0,0,o,i),a}function ht(t,e){return u(this,void 0,void 0,(function(){var n,r,i,a,c,s;return h(this,(function(u){switch(u.label){case 0:return n=e||Q.getEnv().createCanvasElement(),r=t.shape.slice(v(t)?1:0),i=r[0],a=r[1],c=r[2],s=o.lub((function(){return t.as3D(i,a,c).toInt()})),[4,o.Xhn.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}}))}))}function ft(t){var e=Q.getEnv(),n=e.Image,r=e.Canvas,o=e.Video;return t instanceof n||t instanceof r||t instanceof o}var pt=function(){function t(t,e){var n=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach((function(t,e){if(d(t))return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape);if(v(t)){var r=t.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape.slice(1))}var o=t instanceof Q.getEnv().Canvas?t:ut(t);n._canvases[e]=o,n._inputDimensions[e]=[o.height,o.width,3]}))}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var t=this;return w(this.batchSize,0,1).map((function(e,n){return t.getReshapedInputDimensions(n)}))},enumerable:!0,configurable:!0}),t.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},t.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},t.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},t.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},t.prototype.getReshapedInputDimensions=function(t){if("number"!==typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(t,e){var n=t.width,r=t.height,o=e/Math.max(r,n);return new p(Math.round(n*o),Math.round(r*o))}({width:this.getInputWidth(t),height:this.getInputHeight(t)},this.inputSize)},t.prototype.toBatchTensor=function(t,e){var n=this;return void 0===e&&(e=!0),this._inputSize=t,o.lub((function(){var r=w(n.batchSize,0,1).map((function(r){var i=n.getInput(r);if(i instanceof o.esB){var a=v(i)?i:i.expandDims();return(a=function(t,e){return void 0===e&&(e=!1),o.lub((function(){var n=t.shape.slice(1),r=n[0],i=n[1];if(r===i)return t;var a=Math.abs(r-i),c=Math.round(a*(e?.5:1)),s=r>i?2:1,u=function(e){var n=t.shape.slice();return n[s]=e,o.hlL(n,0)},h=u(c),f=a-h.shape[s],p=[e&&f?u(f):null,t,h].filter((function(t){return!!t})).map((function(t){return t.toFloat()}));return o.zoF(p,s)}))}(a,e)).shape[1]===t&&a.shape[2]===t||(a=o.BHj.resizeBilinear(a,[t,t])),a.as3D(t,t,3)}if(i instanceof Q.getEnv().Canvas)return o.Xhn.fromPixels(function(t,e,n){void 0===n&&(n=!1);var r=Q.getEnv(),o=r.Image,i=r.Canvas;if(!(t instanceof o||t instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=ct(t),c=e/Math.max(a.height,a.width),s=c*a.width,u=c*a.height,h=st({width:e,height:e}),f=t instanceof i?t:ut(t),p=Math.abs(s-u)/2,l=n&&s<u?p:0,d=n&&u<s?p:0;return Z(h).drawImage(f,l,d,s,u),h}(i,t,e));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+i)}));return o.knu(r.map((function(t){return t.toFloat()}))).as4D(n.batchSize,t,t,3)}))},t}();function lt(t){return u(this,void 0,void 0,(function(){var e,n,r;return h(this,(function(o){switch(o.label){case 0:if(t instanceof pt)return[2,t];if(!(e=Array.isArray(t)?t:[t]).length)throw new Error("toNetInput - empty array passed as input");return n=function(e){return Array.isArray(t)?" at input index "+e+":":""},(r=e.map(q)).forEach((function(t,r){if(!ft(t)&&!d(t)&&!v(t)){if("string"===typeof e[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+e[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(v(t)){var o=t.shape[0];if(1!==o)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}})),[4,Promise.all(r.map((function(t){return ft(t)&&(e=t,new Promise((function(t,n){if(e instanceof Q.getEnv().Canvas||it(e))return t();function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",o),t(e))}function o(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),n(t))}e.addEventListener("load",r),e.addEventListener("error",o)})));var e})))];case 1:return o.sent(),[2,new pt(r,Array.isArray(t))]}}))}))}function dt(t,e){return u(this,void 0,void 0,(function(){var n,r,o,i,a,c;return h(this,(function(s){switch(s.label){case 0:return n=Q.getEnv().Canvas,r=t,t instanceof n?[3,5]:[4,lt(t)];case 1:if((o=s.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=o.getInput(0))instanceof n?(a=i,[3,4]):[3,2];case 2:return[4,ht(i)];case 3:a=s.sent(),s.label=4;case 4:r=a,s.label=5;case 5:return c=Z(r),[2,e.map((function(t){return t instanceof D?t.forSize(r.width,r.height).box.floor():t})).map((function(t){return t.clipAtImageBorders(r.width,r.height)})).map((function(t){var e=t.x,n=t.y,r=t.width,o=t.height,i=st({width:r,height:o});return Z(i).putImageData(c.getImageData(e,n,r,o),0,0),i}))]}}))}))}function vt(t,e){return u(this,void 0,void 0,(function(){return h(this,(function(n){if(!d(t)&&!v(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(v(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,o.lub((function(){var n=t.shape.slice(v(t)?1:0),r=n[0],i=n[1],a=n[2];return e.map((function(t){return t instanceof D?t.forSize(i,r).box:t})).map((function(t){return t.clipAtImageBorders(i,r)})).map((function(e){var n=e.x,c=e.y,s=e.width,u=e.height;return o.CnO(t.as3D(r,i,a),[c,n,0],[u,s,a])}))}))]}))}))}function mt(t,e){return u(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return[4,(0,Q.getEnv().fetch)(t,e)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}}))}))}function gt(t){return u(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,mt(t)];case 1:return[2,e.sent().json()]}}))}))}function bt(t,e){var n=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:n};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+n};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",o=(t=t.replace(r,"")).split("/").filter((function(t){return t})),i=t.endsWith(".json")?o[o.length-1]:n,a=r+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}function _t(t,e){return u(this,void 0,void 0,(function(){var n,r,i,a;return h(this,(function(c){switch(c.label){case 0:return n=bt(t,e),r=n.manifestUri,i=n.modelBaseUri,[4,gt(r)];case 1:return a=c.sent(),[2,o.io.loadWeights(a,i)]}}))}))}function wt(t,e,n){void 0===n&&(n=!1);var r=n?ct(e):e,o=r.width,i=r.height;return t.width=o,t.height=i,{width:o,height:i}}var yt=function(){function t(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(t,e){var n=this.traversePropertyPath(t),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=e},t.prototype.getParamList=function(){var t=this;return this._paramMappings.map((function(e){var n=e.paramPath;return{path:n,tensor:t.getParamFromPath(n)}}))},t.prototype.getTrainableParams=function(){return this.getParamList().filter((function(t){return t.tensor instanceof o._wD}))},t.prototype.getFrozenParams=function(){return this.getParamList().filter((function(t){return!(t.tensor instanceof o._wD)}))},t.prototype.variable=function(){var t=this;this.getFrozenParams().forEach((function(e){var n=e.path,r=e.tensor;t.reassignParamFromPath(n,r.variable())}))},t.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach((function(e){var n=e.path,r=e.tensor,i=o.XeE(r.dataSync());r.dispose(),t.reassignParamFromPath(n,i)}))},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach((function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()})),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map((function(t){var e=t.tensor;return Array.from(e.dataSync())})).reduce((function(t,e){return t.concat(e)})))},t.prototype.load=function(t){return u(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}}))}))},t.prototype.loadFromUri=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:if(t&&"string"!==typeof t)throw new Error(this._name+".loadFromUri - expected model uri");return[4,_t(t,this.getDefaultModelName())];case 1:return e=n.sent(),this.loadFromWeightMap(e),[2]}}))}))},t.prototype.loadFromDisk=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,a,c,s,u,f,p;return h(this,(function(h){switch(h.label){case 0:if(t&&"string"!==typeof t)throw new Error(this._name+".loadFromDisk - expected model file path");return e=Q.getEnv().readFile,n=bt(t,this.getDefaultModelName()),r=n.manifestUri,i=n.modelBaseUri,a=function(t){return Promise.all(t.map((function(t){return e(t).then((function(t){return t.buffer}))})))},c=o.io.weightsLoaderFactory(a),f=(u=JSON).parse,[4,e(r)];case 1:return s=f.apply(u,[h.sent().toString()]),[4,c(s,i)];case 2:return p=h.sent(),this.loadFromWeightMap(p),[2]}}))}))},t.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.extractWeights=function(t){var e=this.extractParams(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce((function(e,n){if(!e.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+t);return{obj:e.nextObj,objProp:n,nextObj:e.nextObj[n]}}),{nextObj:this.params}),n=e.obj,r=e.objProp;if(!n||!r||!(n[r]instanceof o.esB))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:n,objProp:r}},t}();function xt(t,e,n){return o.lub((function(){var r=o.U_I(t,e.depthwise_filter,e.pointwise_filter,n,"same");return r=o.IHx(r,e.bias)}))}function Pt(t,e,n){return void 0===n&&(n=!1),o.lub((function(){var r=o.UYe(n?o.IHx(o.Tek(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):xt(t,e.conv0,[2,2])),i=xt(r,e.conv1,[1,1]),a=xt(o.UYe(o.IHx(r,i)),e.conv2,[1,1]);return o.UYe(o.IHx(r,o.IHx(i,a)))}))}function Et(t,e,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),o.lub((function(){var i=o.UYe(n?o.IHx(o.Tek(t,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):xt(t,e.conv0,r?[2,2]:[1,1])),a=xt(i,e.conv1,[1,1]),c=xt(o.UYe(o.IHx(i,a)),e.conv2,[1,1]),s=xt(o.UYe(o.IHx(i,o.IHx(a,c))),e.conv3,[1,1]);return o.UYe(o.IHx(i,o.IHx(a,o.IHx(c,s))))}))}function Ft(t,e,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),o.lub((function(){var i=o.IHx(o.Tek(t,e.filters,[1,1],n),e.bias);return r?o.UYe(i):i}))}function Mt(t,e){Object.keys(t).forEach((function(n){e.some((function(t){return t.originalPath===n}))||t[n].dispose()}))}function Dt(t,e){return function(n,r,i,a){var c=o.yXz(t(n*r*i*i),[i,i,n,r]),s=o.RRF(t(r));return e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:c,bias:s}}}function St(t,e){return function(n,r,i){var a=o.odF(t(n*r),[n,r]),c=o.RRF(t(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:a,bias:c}}}var It=function(t,e,n){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=n};function Tt(t,e){return function(n,r,i){var a=o.yXz(t(9*n),[3,3,n,1]),c=o.yXz(t(n*r),[1,1,n,r]),s=o.RRF(t(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new It(a,c,s)}}function Ct(t){return function(e){var n=t(e+"/depthwise_filter",4),r=t(e+"/pointwise_filter",4),o=t(e+"/bias",1);return new It(n,r,o)}}function Ot(t,e){return function(n,r,o){var i=t[n];if(!l(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return e.push({originalPath:n,paramPath:o||n}),i}}function Bt(t){var e=t;return{extractWeights:function(t){var n=e.slice(0,t);return e=e.slice(t),n},getRemainingWeights:function(){return e}}}function kt(t,e){var n=Dt(t,e),r=Tt(t,e);function o(t,e,o,i){return void 0===i&&(i=!1),{conv0:i?n(t,e,3,o+"/conv0"):r(t,e,o+"/conv0"),conv1:r(e,e,o+"/conv1"),conv2:r(e,e,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(t,e,n,i){void 0===i&&(i=!1);var a=o(t,e,n,i);return{conv0:a.conv0,conv1:a.conv1,conv2:a.conv2,conv3:r(e,e,n+"/conv3")}}}}function At(t){return function(e){return{filters:t(e+"/filters",4),bias:t(e+"/bias",1)}}}function Lt(t,e){var n=Ot(t,e),r=At(n),o=Ct(n);return{extractDenseBlock3Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2")}},extractDenseBlock4Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2"),conv3:o(t+"/conv3")}}}}var jt=function(t){function e(){return t.call(this,"FaceFeatureExtractor")||this}return c(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceFeatureExtractor - load model before inference");return o.lub((function(){var n=Et(T(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(o.iD$(255)),e.dense0,!0);return n=Et(n,e.dense1),n=Et(n,e.dense2),n=Et(n,e.dense3),n=o.wS1(n,[7,7],[2,2],"valid")}))},e.prototype.forward=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,lt(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=Lt(t,e).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Mt(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=Bt(t),r=n.extractWeights,o=n.getRemainingWeights,i=kt(r,e).extractDenseBlock4Params,a=i(3,32,"dense0",!0),c=i(32,64,"dense1"),s=i(64,128,"dense2"),u=i(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:c,dense2:s,dense3:u}}}(t)},e}(yt);function Rt(t,e){return o.lub((function(){return o.IHx(o.OI3(t,e.weights),e.bias)}))}function Nt(t){var e={},n={};return Object.keys(t).forEach((function(r){(r.startsWith("fc")?n:e)[r]=t[r]})),{featureExtractorMap:e,classifierMap:n}}var Ht=function(t){function e(e,n){var r=t.call(this,e)||this;return r._faceFeatureExtractor=n,r}return c(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return o.lub((function(){var r=t instanceof pt?e.faceFeatureExtractor.forwardInput(t):t;return Rt(r.as2D(r.shape[0],-1),n.fc)}))},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t,e,n){var r=[],o=Bt(t),i=o.extractWeights,a=o.getRemainingWeights,c=St(i,r)(e,n,"fc");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:c}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var e=Nt(t),n=e.featureExtractorMap,r=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(t){var e,n=[],r=Ot(t,n),o={fc:(e="fc",{weights:r(e+"/weights",2),bias:r(e+"/bias",1)})};return Mt(t,n),{params:o,paramMappings:n}}(r)},e.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*e+n,o=t.slice(0,t.length-r),i=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},e}(yt),Wt=["neutral","happy","sad","angry","fearful","disgusted","surprised"],zt=function(){function t(t){var e=this;if(7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);Wt.forEach((function(n,r){e[n]=t[r]}))}return t.prototype.asSortedArray=function(){var t=this;return Wt.map((function(e){return{expression:e,probability:t[e]}})).sort((function(t,e){return e.probability-t.probability}))},t}(),Ut=function(t){function e(e){return void 0===e&&(e=new jt),t.call(this,"FaceExpressionNet",e)||this}return c(e,t),e.prototype.forwardInput=function(t){var e=this;return o.lub((function(){return o.XAC(e.runNet(t))}))},e.prototype.forward=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,lt(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.predictExpressions=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,a=this;return h(this,(function(c){switch(c.label){case 0:return[4,lt(t)];case 1:return e=c.sent(),[4,this.forwardInput(e)];case 2:return n=c.sent(),[4,Promise.all(o.HHK(n).map((function(t){return u(a,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return[4,t.data()];case 1:return e=n.sent(),t.dispose(),[2,e]}}))}))})))];case 3:return r=c.sent(),n.dispose(),i=r.map((function(t){return new zt(t)})),[2,e.isBatchInput?i:i[0]]}}))}))},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(Ht);function Xt(t,e){var n={expressions:e};return Object.assign({},t,n)}function Yt(t,e,n,r){void 0===n&&(n=.1),(Array.isArray(e)?e:[e]).forEach((function(e){var o=e instanceof zt?e:e.expressions instanceof zt?e.expressions:void 0;if(!o)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var i=o.asSortedArray().filter((function(t){return t.probability>n})),a=N(e)?e.detection.box.bottomLeft:r||new P(0,0);new et(i.map((function(t){return t.expression+" ("+g(t.probability)+")"})),a).draw(t)}))}function Gt(t){return N(t)&&t.landmarks instanceof B&&t.unshiftedLandmarks instanceof B&&t.alignedRect instanceof D}function Vt(t,e){var n=t.detection.box,r=e.shiftBy(n.x,n.y),o=r.align(),i=t.detection.imageDims,a={landmarks:r,unshiftedLandmarks:e,alignedRect:new D(t.detection.score,o.rescale(i.reverse()),i)};return Object.assign({},t,a)}var $t=function(t){void 0===t&&(t={});var e=t.drawLines,n=void 0===e||e,r=t.drawPoints,o=void 0===r||r,i=t.lineWidth,a=t.lineColor,c=t.pointSize,s=t.pointColor;this.drawLines=n,this.drawPoints=o,this.lineWidth=i||1,this.pointSize=c||2,this.lineColor=a||"rgba(0, 255, 255, 1)",this.pointColor=s||"rgba(255, 0, 255, 1)"},Jt=function(){function t(t,e){void 0===e&&(e={}),this.faceLandmarks=t,this.options=new $t(e)}return t.prototype.draw=function(t){var e=Z(t),n=this.options,r=n.drawLines,o=n.drawPoints,a=n.lineWidth,c=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof A&&(e.strokeStyle=c,e.lineWidth=a,i(e,this.faceLandmarks.getJawOutline()),i(e,this.faceLandmarks.getLeftEyeBrow()),i(e,this.faceLandmarks.getRightEyeBrow()),i(e,this.faceLandmarks.getNose()),i(e,this.faceLandmarks.getLeftEye(),!0),i(e,this.faceLandmarks.getRightEye(),!0),i(e,this.faceLandmarks.getMouth(),!0)),o){e.strokeStyle=u,e.fillStyle=u;this.faceLandmarks.positions.forEach((function(t){e.beginPath(),e.arc(t.x,t.y,s,0,2*Math.PI),e.fill()}))}},t}();function Kt(t,e){(Array.isArray(e)?e:[e]).forEach((function(e){var n=e instanceof B?e:Gt(e)?e.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Jt(n).draw(t)}))}function Qt(t,e){var n=[],r=Bt(t),o=r.extractWeights,i=r.getRemainingWeights,a=function(t,e){var n=Dt(t,e),r=Tt(t,e);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(t,e,o){return{separable_conv0:r(t,e,o+"/separable_conv0"),separable_conv1:r(e,e,o+"/separable_conv1"),expansion_conv:n(t,e,1,o+"/expansion_conv")}},extractMainBlockParams:function(t,e){return{separable_conv0:r(t,t,e+"/separable_conv0"),separable_conv1:r(t,t,e+"/separable_conv1"),separable_conv2:r(t,t,e+"/separable_conv2")}}}}(o,n),c=a.extractConvParams,s=a.extractSeparableConvParams,u=a.extractReductionBlockParams,h=a.extractMainBlockParams,f={conv_in:c(3,32,3,"entry_flow/conv_in"),reduction_block_0:u(32,64,"entry_flow/reduction_block_0"),reduction_block_1:u(64,128,"entry_flow/reduction_block_1")},p={};w(e,0,1).forEach((function(t){p["main_block_"+t]=h(128,"middle_flow/main_block_"+t)}));var l={reduction_block:u(128,256,"exit_flow/reduction_block"),separable_conv:s(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{entry_flow:f,middle_flow:p,exit_flow:l}}}function qt(t,e){var n=[],r=function(t,e){var n=Ot(t,e),r=At(n),o=Ct(n);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),expansion_conv:r(t+"/expansion_conv")}},extractMainBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),separable_conv2:o(t+"/separable_conv2")}}}}(t,n),o=r.extractConvParams,i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,c=r.extractMainBlockParams,s={conv_in:o("entry_flow/conv_in"),reduction_block_0:a("entry_flow/reduction_block_0"),reduction_block_1:a("entry_flow/reduction_block_1")},u={};w(e,0,1).forEach((function(t){u["main_block_"+t]=c("middle_flow/main_block_"+t)}));var h={reduction_block:a("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return Mt(t,n),{params:{entry_flow:s,middle_flow:u,exit_flow:h},paramMappings:n}}function Zt(t,e,n){return o.IHx(o.Tek(t,e.filters,n,"same"),e.bias)}function te(t,e,n){void 0===n&&(n=!0);var r=n?o.UYe(t):t;return r=xt(r,e.separable_conv0,[1,1]),r=xt(o.UYe(r),e.separable_conv1,[1,1]),r=o._sB(r,[3,3],[2,2],"same"),r=o.IHx(r,Zt(t,e.expansion_conv,[2,2]))}var ee,ne=function(t){function e(e){var n=t.call(this,"TinyXception")||this;return n._numMainBlocks=e,n}return c(e,t),e.prototype.forwardInput=function(t){var e=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return o.lub((function(){var r=T(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(o.iD$(256)),i=o.UYe(Zt(r,n.entry_flow.conv_in,[2,2]));return i=te(i,n.entry_flow.reduction_block_0,!1),i=te(i,n.entry_flow.reduction_block_1),w(e._numMainBlocks,0,1).forEach((function(t){i=function(t,e){var n=xt(o.UYe(t),e.separable_conv0,[1,1]);return n=xt(o.UYe(n),e.separable_conv1,[1,1]),n=xt(o.UYe(n),e.separable_conv2,[1,1]),o.IHx(n,t)}(i,n.middle_flow["main_block_"+t])})),i=te(i,n.exit_flow.reduction_block),i=o.UYe(xt(i,n.exit_flow.separable_conv,[1,1]))}))},e.prototype.forward=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,lt(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return qt(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return Qt(t,this._numMainBlocks)},e}(yt);!function(t){t.FEMALE="female",t.MALE="male"}(ee||(ee={}));var re=function(t){function e(e){void 0===e&&(e=new ne(2));var n=t.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=e,n}return c(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return o.lub((function(){var r=t instanceof pt?e.faceFeatureExtractor.forwardInput(t):t,i=o.wS1(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:Rt(i,n.fc.age).as1D(),gender:Rt(i,n.fc.gender)}}))},e.prototype.forwardInput=function(t){var e=this;return o.lub((function(){var n=e.runNet(t),r=n.age,i=n.gender;return{age:r,gender:o.XAC(i)}}))},e.prototype.forward=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,lt(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.predictAgeAndGender=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,a,c,s=this;return h(this,(function(f){switch(f.label){case 0:return[4,lt(t)];case 1:return e=f.sent(),[4,this.forwardInput(e)];case 2:return n=f.sent(),r=o.HHK(n.age),i=o.HHK(n.gender),a=r.map((function(t,e){return{ageTensor:t,genderTensor:i[e]}})),[4,Promise.all(a.map((function(t){var e=t.ageTensor,n=t.genderTensor;return u(s,void 0,void 0,(function(){var t,r,o,i,a;return h(this,(function(c){switch(c.label){case 0:return[4,e.data()];case 1:return t=c.sent()[0],[4,n.data()];case 2:return r=c.sent()[0],i=(o=r>.5)?ee.MALE:ee.FEMALE,a=o?r:1-r,e.dispose(),n.dispose(),[2,{age:t,gender:i,genderProbability:a}]}}))}))})))];case 3:return c=f.sent(),n.age.dispose(),n.gender.dispose(),[2,e.isBatchInput?c:c[0]]}}))}))},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t){var e=[],n=Bt(t),r=n.extractWeights,o=n.getRemainingWeights,i=St(r,e),a=i(512,1,"fc/age"),c=i(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{fc:{age:a,gender:c}}}}(t)},e.prototype.extractParamsFromWeigthMap=function(t){var e=Nt(t),n=e.featureExtractorMap,r=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(t){var e=[],n=Ot(t,e);function r(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Mt(t,e),{params:o,paramMappings:e}}(r)},e.prototype.extractParams=function(t){var e=t.slice(0,t.length-1539),n=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(e),this.extractClassifierParams(n)},e}(yt),oe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.postProcess=function(t,e,n){var r=n.map((function(t){var n=t.width,r=t.height,o=e/Math.max(r,n);return{width:n*o,height:r*o}})),i=r.length;return o.lub((function(){var n=function(t,e){return o.knu([o.hlL([68],t),o.hlL([68],e)],1).as2D(1,136).as1D()},a=function(t,e){var n=r[t],o=n.width,i=n.height;return e(o,i)?Math.abs(o-i)/2:0};return t.mul(o.hlL([i,136],e)).sub(o.knu(Array.from(Array(i),(function(t,e){return n(function(t){return a(t,(function(t,e){return t<e}))}(e),function(t){return a(t,(function(t,e){return e<t}))}(e))})))).div(o.knu(Array.from(Array(i),(function(t,e){return n(r[e].width,r[e].height)}))))}))},e.prototype.forwardInput=function(t){var e=this;return o.lub((function(){var n=e.runNet(t);return e.postProcess(n,t.inputSize,t.inputDimensions.map((function(t){return{height:t[0],width:t[1]}})))}))},e.prototype.forward=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,lt(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.detectLandmarks=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i=this;return h(this,(function(a){switch(a.label){case 0:return[4,lt(t)];case 1:return e=a.sent(),n=o.lub((function(){return o.HHK(i.forwardInput(e))})),[4,Promise.all(n.map((function(t,n){return u(i,void 0,void 0,(function(){var r,o,i,a,c;return h(this,(function(s){switch(s.label){case 0:return i=(o=Array).from,[4,t.data()];case 1:return r=i.apply(o,[s.sent()]),a=r.filter((function(t,e){return m(e)})),c=r.filter((function(t,e){return!m(e)})),[2,new A(Array(68).fill(0).map((function(t,e){return new P(a[e],c[e])})),{height:e.getInputHeight(n),width:e.getInputWidth(n)})]}}))}))})))];case 2:return r=a.sent(),n.forEach((function(t){return t.dispose()})),[2,e.isBatchInput?r:r[0]]}}))}))},e.prototype.getClassifierChannelsOut=function(){return 136},e}(Ht),ie=function(t){function e(e){return void 0===e&&(e=new jt),t.call(this,"FaceLandmark68Net",e)||this}return c(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(oe);var ae=function(t){function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return c(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("TinyFaceFeatureExtractor - load model before inference");return o.lub((function(){var n=Pt(T(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(o.iD$(255)),e.dense0,!0);return n=Pt(n,e.dense1),n=Pt(n,e.dense2),n=o.wS1(n,[14,14],[2,2],"valid")}))},e.prototype.forward=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,lt(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=Lt(t,e).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Mt(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=Bt(t),r=n.extractWeights,o=n.getRemainingWeights,i=kt(r,e).extractDenseBlock3Params,a=i(3,32,"dense0",!0),c=i(32,64,"dense1"),s=i(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:c,dense2:s}}}(t)},e}(yt),ce=function(t){function e(e){return void 0===e&&(e=new ae),t.call(this,"FaceLandmark68TinyNet",e)||this}return c(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(oe);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}c(e,t)}(ie);function se(t,e,n,r,i){void 0===i&&(i="same");var a=e.conv,c=a.filters,s=a.bias,u=o.Tek(t,c,n,i);return u=function(t,e){return o.IHx(o.dC7(t,e.weights),e.biases)}(u=o.IHx(u,s),e.scale),r?o.UYe(u):u}function ue(t,e){return se(t,e,[1,1],!1)}function he(t,e){return se(t,e,[2,2],!0,"valid")}function fe(t,e){function n(n,r,i,a){var c=function(e,n,r){var i=t(e),a=i.length/(n*r*r);if(a%1!==0)throw new Error("depth has to be an integer: "+a+", weights.length: "+i.length+", numFilters: "+n+", filterSize: "+r);return o.lub((function(){return o.p4s(o.yXz(i,[n,a,r,r]),[2,3,1,0])}))}(n,r,i),s=o.RRF(t(r));return e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:c,bias:s}}function r(r,i,a,c){return{conv:n(r,i,a,c+"/conv"),scale:function(n,r){var i=o.RRF(t(n)),a=o.RRF(t(n));return e.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:i,biases:a}}(i,c+"/scale")}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t,e,n,o,i){return void 0===i&&(i=!1),{conv1:r((i?.5:1)*t,e,n,o+"/conv1"),conv2:r(t,e,n,o+"/conv2")}}}}function pe(t,e){var n=Ot(t,e);function r(t){return{conv:{filters:n(t+"/conv/filters",4),bias:n(t+"/conv/bias",1)},scale:function(t){return{weights:n(t+"/scale/weights",1),biases:n(t+"/scale/biases",1)}}(t)}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t){return{conv1:r(t+"/conv1"),conv2:r(t+"/conv2")}}}}function le(t){var e=[],n=pe(t,e),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,i=r("conv32_down"),a=o("conv32_1"),c=o("conv32_2"),s=o("conv32_3"),u=o("conv64_down"),h=o("conv64_1"),f=o("conv64_2"),p=o("conv64_3"),d=o("conv128_down"),v=o("conv128_1"),m=o("conv128_2"),g=o("conv256_down"),b=o("conv256_1"),_=o("conv256_2"),w=o("conv256_down_out"),y=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!l(y,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+y);var x={conv32_down:i,conv32_1:a,conv32_2:c,conv32_3:s,conv64_down:u,conv64_1:h,conv64_2:f,conv64_3:p,conv128_down:d,conv128_1:v,conv128_2:m,conv256_down:g,conv256_1:b,conv256_2:_,conv256_down_out:w,fc:y};return Mt(t,e),{params:x,paramMappings:e}}function de(t,e){var n=function(t,e){return se(t,e,[1,1],!0)}(t,e.conv1);return n=ue(n,e.conv2),n=o.IHx(n,t),n=o.UYe(n)}function ve(t,e){var n=he(t,e.conv1);n=ue(n,e.conv2);var r=o.wS1(t,2,2,"valid"),i=o.lls(r.shape),a=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var c=f(n.shape);c[1]=1;var s=o.lls(c),u=f((n=o.zoF([n,s],1)).shape);u[2]=1;var h=o.lls(u);n=o.zoF([n,h],2)}return r=a?o.zoF([r,i],3):r,n=o.IHx(r,n),n=o.UYe(n)}var me=function(t){function e(){return t.call(this,"FaceRecognitionNet")||this}return c(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceRecognitionNet - load model before inference");return o.lub((function(){var n=he(T(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(o.iD$(256)),e.conv32_down);n=de(n=o._sB(n,3,2,"valid"),e.conv32_1),n=de(n,e.conv32_2),n=de(n,e.conv32_3),n=de(n=ve(n,e.conv64_down),e.conv64_1),n=de(n,e.conv64_2),n=de(n,e.conv64_3),n=de(n=ve(n,e.conv128_down),e.conv128_1),n=de(n,e.conv128_2),n=de(n=ve(n,e.conv256_down),e.conv256_1);var r=(n=ve(n=de(n,e.conv256_2),e.conv256_down_out)).mean([1,2]);return o.OI3(r,e.fc)}))},e.prototype.forward=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,lt(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.computeFaceDescriptor=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i=this;return h(this,(function(a){switch(a.label){case 0:return[4,lt(t)];case 1:return e=a.sent(),n=o.lub((function(){return o.HHK(i.forwardInput(e))})),[4,Promise.all(n.map((function(t){return t.data()})))];case 2:return r=a.sent(),n.forEach((function(t){return t.dispose()})),[2,e.isBatchInput?r:r[0]]}}))}))},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return le(t)},e.prototype.extractParams=function(t){return function(t){var e=Bt(t),n=e.extractWeights,r=e.getRemainingWeights,i=[],a=fe(n,i),c=a.extractConvLayerParams,s=a.extractResidualLayerParams,u=c(4704,32,7,"conv32_down"),h=s(9216,32,3,"conv32_1"),f=s(9216,32,3,"conv32_2"),p=s(9216,32,3,"conv32_3"),l=s(36864,64,3,"conv64_down",!0),d=s(36864,64,3,"conv64_1"),v=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),b=s(147456,128,3,"conv128_1"),_=s(147456,128,3,"conv128_2"),w=s(589824,256,3,"conv256_down",!0),y=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),P=s(589824,256,3,"conv256_down_out"),E=o.lub((function(){return o.p4s(o.odF(n(32768),[128,256]),[1,0])}));if(i.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:h,conv32_2:f,conv32_3:p,conv64_down:l,conv64_1:d,conv64_2:v,conv64_3:m,conv128_down:g,conv128_1:b,conv128_2:_,conv256_down:w,conv256_1:y,conv256_2:x,conv256_down_out:P,fc:E},paramMappings:i}}(t)},e}(yt);function ge(t,e,n){var r={gender:e,genderProbability:n};return Object.assign({},t,r)}var be=function(){function t(t){var e=void 0===t?{}:t,n=e.minFaceSize,r=e.scaleFactor,o=e.maxNumScales,i=e.scoreThresholds,a=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=a,"number"!==typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!==typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!==typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some((function(t){return"number"!==typeof t})))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some((function(t){return"number"!==typeof t}))))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function _e(t,e){function n(n,r,i,a,c){var s=o.yXz(t(n*r*i*i),[i,i,n,r]),u=o.RRF(t(r));return e.push({paramPath:a+"/filters"},{paramPath:a+"/"+(c?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(t,e,r,o){var i=n(t,e,r,o,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function i(n,i,a){return{depthwise_conv:function(n,r){var i=o.yXz(t(9*n),[3,3,n,1]),a=o.RRF(t(n)),c=o.RRF(t(n)),s=o.RRF(t(n)),u=o.RRF(t(n));return e.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:i,batch_norm_scale:a,batch_norm_offset:c,batch_norm_mean:s,batch_norm_variance:u}}(n,a+"/depthwise_conv"),pointwise_conv:r(n,i,1,a+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:i(32,64,"mobilenetv1/conv_1"),conv_2:i(64,128,"mobilenetv1/conv_2"),conv_3:i(128,128,"mobilenetv1/conv_3"),conv_4:i(128,256,"mobilenetv1/conv_4"),conv_5:i(256,256,"mobilenetv1/conv_5"),conv_6:i(256,512,"mobilenetv1/conv_6"),conv_7:i(512,512,"mobilenetv1/conv_7"),conv_8:i(512,512,"mobilenetv1/conv_8"),conv_9:i(512,512,"mobilenetv1/conv_9"),conv_10:i(512,512,"mobilenetv1/conv_10"),conv_11:i(512,512,"mobilenetv1/conv_11"),conv_12:i(512,1024,"mobilenetv1/conv_12"),conv_13:i(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function we(t){var e=[],n=function(t,e){var n=Ot(t,e);function r(t,e,r){return{filters:n(t+"/Conv2d_"+e+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(t+"/Conv2d_"+e+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function o(t){var e="mobilenetv1/conv_"+t,o="MobilenetV1/Conv2d_"+t+"_depthwise",i=e+"/depthwise_conv",a=e+"/pointwise_conv";return{depthwise_conv:{filters:n(o+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:n(o+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:n(o+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:n(o+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:n(o+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",t,a)}}function i(t,e){return{filters:n(t+"/weights",4,e+"/filters"),bias:n(t+"/biases",1,e+"/bias")}}function a(t){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+t+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+t+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+t+"/ClassPredictor","prediction_layer/box_predictor_"+t+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(t,e),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,i=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!d(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return Mt(t,e),{params:a,paramMappings:e}}function ye(t,e,n){return o.lub((function(){var r=o.Tek(t,e.filters,n,"same");return r=o.IHx(r,e.batch_norm_offset),o.iUl(r,0,6)}))}function xe(t,e){return o.lub((function(){var n=null,r=ye(t,e.conv_0,[2,2]);if([e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13].forEach((function(t,e){var i=e+1,a=function(t){return[2,4,6,12].some((function(e){return e===t}))?[2,2]:[1,1]}(i);r=ye(r=function(t,e,n){return o.lub((function(){var r=o.B10(t,e.filters,n,"same");return r=o.tgs(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,.0010000000474974513),o.iUl(r,0,6)}))}(r,t.depthwise_conv,a),t.pointwise_conv,[1,1]),11===i&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}function Pe(t,e,n){var r=t.arraySync(),o=Math.min(r[e][0],r[e][2]),i=Math.min(r[e][1],r[e][3]),a=Math.max(r[e][0],r[e][2]),c=Math.max(r[e][1],r[e][3]),s=Math.min(r[n][0],r[n][2]),u=Math.min(r[n][1],r[n][3]),h=Math.max(r[n][0],r[n][2]),f=Math.max(r[n][1],r[n][3]),p=(a-o)*(c-i),l=(h-s)*(f-u);if(p<=0||l<=0)return 0;var d=Math.max(o,s),v=Math.max(i,u),m=Math.min(a,h),g=Math.min(c,f),b=Math.max(m-d,0)*Math.max(g-v,0);return b/(p+l-b)}function Ee(t,e){var n=function(t){var e=o.HHK(o.p4s(t,[1,0])),n=[o.luU(e[2],e[0]),o.luU(e[3],e[1])];return{sizes:n,centers:[o.IHx(e[0],o.hiC(n[0],o.iD$(2))),o.IHx(e[1],o.hiC(n[1],o.iD$(2)))]}}(t),r=n.sizes,i=n.centers,a=o.HHK(o.p4s(e,[1,0])),c=o.hiC(o.dC7(o.Qqt(o.hiC(a[2],o.iD$(5))),r[0]),o.iD$(2)),s=o.IHx(o.dC7(o.hiC(a[0],o.iD$(10)),r[0]),i[0]),u=o.hiC(o.dC7(o.Qqt(o.hiC(a[3],o.iD$(5))),r[1]),o.iD$(2)),h=o.IHx(o.dC7(o.hiC(a[1],o.iD$(10)),r[1]),i[1]);return o.p4s(o.knu([o.luU(s,c),o.luU(h,u),o.IHx(s,c),o.IHx(h,u)]),[1,0])}function Fe(t,e){return o.lub((function(){var n=t.shape[0];return{boxPredictionEncoding:o.XLQ(Ft(t,e.box_encoding_predictor),[n,-1,1,4]),classPrediction:o.XLQ(Ft(t,e.class_predictor),[n,-1,3])}}))}var Me=function(){function t(t){var e=void 0===t?{}:t,n=e.minConfidence,r=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!==typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!==typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),De=function(t){function e(){return t.call(this,"SsdMobilenetv1")||this}return c(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("SsdMobilenetv1 - load model before inference");return o.lub((function(){var n=t.toBatchTensor(512,!1).toFloat(),r=xe(o.luU(o.dC7(n,o.iD$(.007843137718737125)),o.iD$(1)),e.mobilenetv1),i=function(t,e,n){return o.lub((function(){var r=ye(t,n.conv_0,[1,1]),i=ye(r,n.conv_1,[2,2]),a=ye(i,n.conv_2,[1,1]),c=ye(a,n.conv_3,[2,2]),s=ye(c,n.conv_4,[1,1]),u=ye(s,n.conv_5,[2,2]),h=ye(u,n.conv_6,[1,1]),f=ye(h,n.conv_7,[2,2]),p=Fe(e,n.box_predictor_0),l=Fe(t,n.box_predictor_1),d=Fe(i,n.box_predictor_2),v=Fe(c,n.box_predictor_3),m=Fe(u,n.box_predictor_4),g=Fe(f,n.box_predictor_5);return{boxPredictions:o.zoF([p.boxPredictionEncoding,l.boxPredictionEncoding,d.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:o.zoF([p.classPrediction,l.classPrediction,d.classPrediction,v.classPrediction,m.classPrediction,g.classPrediction],1)}}))}(r.out,r.conv11,e.prediction_layer);return function(t,e,n){return o.lub((function(){var r=t.shape[0],i=Ee(o.XLQ(o.Gg6(n.extra_dim,[r,1,1]),[-1,4]),o.XLQ(t,[-1,4]));i=o.XLQ(i,[r,i.shape[0]/r,4]);var a=o.XD2(o.tPi(e,[0,0,1],[-1,-1,-1])),c=o.tPi(a,[0,0,0],[-1,-1,1]);return c=o.XLQ(c,[r,c.shape[1]]),{boxes:o.HHK(i),scores:o.HHK(c)}}))}(i.boxPredictions,i.classPredictions,e.output_layer)}))},e.prototype.forward=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return e=this.forwardInput,[4,lt(t)];case 1:return[2,e.apply(this,[n.sent()])]}}))}))},e.prototype.locateFaces=function(t,e){return void 0===e&&(e={}),u(this,void 0,void 0,(function(){var n,r,o,i,a,c,s,u,f,p,l,d,v,m,g,b,_,w,y,x;return h(this,(function(h){switch(h.label){case 0:return n=new Me(e),r=n.maxResults,o=n.minConfidence,[4,lt(t)];case 1:for(i=h.sent(),a=this.forwardInput(i),c=a.boxes,s=a.scores,u=c[0],f=s[0],p=1;p<c.length;p++)c[p].dispose(),s[p].dispose();return v=(d=Array).from,[4,f.data()];case 2:return l=v.apply(d,[h.sent()]),.5,m=function(t,e,n,r,o){var i=t.shape[0],a=Math.min(n,i),c=e.map((function(t,e){return{score:t,boxIndex:e}})).filter((function(t){return t.score>o})).sort((function(t,e){return e.score-t.score})),s=[];return c.forEach((function(e){if(!(s.length>=a)){for(var n=e.score,i=s.length-1;i>=0;--i){var c=Pe(t,e.boxIndex,s[i]);if(0!==c&&(e.score*=c<=r?1:0,e.score<=o))break}n===e.score&&s.push(e.boxIndex)}})),s}(u,l,r,.5,o),g=i.getReshapedInputDimensions(0),b=i.inputSize,_=b/g.width,w=b/g.height,y=u.arraySync(),x=m.map((function(t){var e=[Math.max(0,y[t][0]),Math.min(1,y[t][2])].map((function(t){return t*w})),n=e[0],r=e[1],o=[Math.max(0,y[t][1]),Math.min(1,y[t][3])].map((function(t){return t*_})),a=o[0],c=o[1];return new D(l[t],new O(a,n,c-a,r-n),{height:i.getInputHeight(0),width:i.getInputWidth(0)})})),u.dispose(),f.dispose(),[2,x]}}))}))},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return we(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=Bt(t),r=n.extractWeights,i=n.getRemainingWeights,a=_e(r,e),c=a.extractMobilenetV1Params,s=a.extractPredictionLayerParams,u=c(),h=s(),f={extra_dim:o.wOQ(r(20472),[1,5118,4])};if(e.push({paramPath:"output_layer/extra_dim"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:h,output_layer:f},paramMappings:e}}(t)},e}(yt);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}c(e,t)}(De);var Se,Ie=[new P(.738768,.874946),new P(2.42204,2.65704),new P(4.30971,7.04493),new P(10.246,4.59428),new P(12.6868,11.8741)],Te=[new P(1.603231,2.094468),new P(6.041143,7.080126),new P(2.882459,3.518061),new P(4.266906,5.178857),new P(9.041765,10.66308)],Ce=[117.001,114.697,97.404],Oe=function(t){return"number"===typeof t};function Be(t){return o.lub((function(){var e=o.dC7(t,o.iD$(.10000000149011612));return o.IHx(o.UYe(o.luU(t,e)),e)}))}function ke(t,e){return o.lub((function(){var n=o.vku(t,[[0,0],[1,1],[1,1],[0,0]]);return n=o.Tek(n,e.conv.filters,[1,1],"valid"),n=o.luU(n,e.bn.sub),n=o.dC7(n,e.bn.truediv),Be(n=o.IHx(n,e.conv.bias))}))}function Ae(t,e){return o.lub((function(){var n=o.vku(t,[[0,0],[1,1],[1,1],[0,0]]);return n=o.U_I(n,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),Be(n=o.IHx(n,e.bias))}))}function Le(t,e){var n=Dt(t,e);var r=Tt(t,e);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,i,a){return{conv:n(r,i,3,a+"/conv"),bn:function(n,r){var i=o.RRF(t(n)),a=o.RRF(t(n));return e.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:i,truediv:a}}(i,a+"/bn")}},extractSeparableConvParams:r}}function je(t,e){var n=Ot(t,e);function r(t){return{filters:n(t+"/filters",4),bias:n(t+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(t){return{conv:r(t+"/conv"),bn:function(t){return{sub:n(t+"/sub",1),truediv:n(t+"/truediv",1)}}(t+"/bn")}},extractSeparableConvParams:Ct(n)}}!function(t){t[t.XS=224]="XS",t[t.SM=320]="SM",t[t.MD=416]="MD",t[t.LG=608]="LG"}(Se||(Se={}));var Re=function(){function t(t){var e=void 0===t?{}:t,n=e.inputSize,r=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!==typeof this._inputSize||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!==typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),Ne=function(t){function e(e){var n=t.call(this,"TinyYolov2")||this;return function(t){if(!t)throw new Error("invalid config: "+t);if("boolean"!==typeof t.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!Oe(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every((function(t){return"string"===typeof t})))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map((function(t){return t||{}})).every((function(t){return Oe(t.x)&&Oe(t.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(Oe)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}(e),n._config=e,n}return c(e,t),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,e){var n=ke(t,e.conv0);return n=ke(n=o._sB(n,[2,2],[2,2],"same"),e.conv1),n=ke(n=o._sB(n,[2,2],[2,2],"same"),e.conv2),n=ke(n=o._sB(n,[2,2],[2,2],"same"),e.conv3),n=ke(n=o._sB(n,[2,2],[2,2],"same"),e.conv4),n=ke(n=o._sB(n,[2,2],[2,2],"same"),e.conv5),n=ke(n=o._sB(n,[2,2],[1,1],"same"),e.conv6),Ft(n=ke(n,e.conv7),e.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,e){var n=this.config.isFirstLayerConv2d?Be(Ft(t,e.conv0,"valid",!1)):Ae(t,e.conv0);return n=Ae(n=o._sB(n,[2,2],[2,2],"same"),e.conv1),n=Ae(n=o._sB(n,[2,2],[2,2],"same"),e.conv2),n=Ae(n=o._sB(n,[2,2],[2,2],"same"),e.conv3),n=Ae(n=o._sB(n,[2,2],[2,2],"same"),e.conv4),n=Ae(n=o._sB(n,[2,2],[2,2],"same"),e.conv5),n=o._sB(n,[2,2],[1,1],"same"),n=e.conv6?Ae(n,e.conv6):n,Ft(n=e.conv7?Ae(n,e.conv7):n,e.conv8,"valid",!1)},e.prototype.forwardInput=function(t,e){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return o.lub((function(){var i=t.toBatchTensor(e,!1).toFloat();return i=(i=n.config.meanRgb?T(i,n.config.meanRgb):i).div(o.iD$(256)),n.config.withSeparableConvs?n.runMobilenet(i,r):n.runTinyYolov2(i,r)}))},e.prototype.forward=function(t,e){return u(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,lt(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent()]}}))}))},e.prototype.detect=function(t,e){return void 0===e&&(e={}),u(this,void 0,void 0,(function(){var n,r,i,a,c,s,u,f,p,l,d,v,m,g=this;return h(this,(function(h){switch(h.label){case 0:return n=new Re(e),r=n.inputSize,i=n.scoreThreshold,[4,lt(t)];case 1:return a=h.sent(),[4,this.forwardInput(a,r)];case 2:return c=h.sent(),s=o.lub((function(){return o.HHK(c)[0].expandDims()})),u={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(s,a.getReshapedInputDimensions(0),i)];case 3:return f=h.sent(),c.dispose(),s.dispose(),p=f.map((function(t){return t.box})),l=f.map((function(t){return t.score})),d=f.map((function(t){return t.classScore})),v=f.map((function(t){return g.config.classes[t.label]})),m=I(p.map((function(t){return t.rescale(r)})),l,this.config.iouThreshold,!0),[2,m.map((function(t){return new M(l[t],d[t],v[t],p[t],u)}))]}}))}))},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var n,r=[],o=je(t,r),i=o.extractConvParams,a=o.extractConvWithBatchNormParams,c=o.extractSeparableConvParams;if(e.withSeparableConvs){var s=e.filterSizes&&e.filterSizes.length||9;n={conv0:e.isFirstLayerConv2d?i("conv0"):c("conv0"),conv1:c("conv1"),conv2:c("conv2"),conv3:c("conv3"),conv4:c("conv4"),conv5:c("conv5"),conv6:s>7?c("conv6"):void 0,conv7:s>8?c("conv7"):void 0,conv8:i("conv8")}}else n={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return Mt(t,r),{params:n,paramMappings:r}}(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(t,e,n,r){var o,i=Bt(t),a=i.extractWeights,c=i.getRemainingWeights,s=[],u=Le(a,s),h=u.extractConvParams,f=u.extractConvWithBatchNormParams,p=u.extractSeparableConvParams;if(e.withSeparableConvs){var l=r[0],d=r[1],v=r[2],m=r[3],g=r[4],b=r[5],_=r[6],w=r[7],y=r[8];o={conv0:e.isFirstLayerConv2d?h(l,d,3,"conv0"):p(l,d,"conv0"),conv1:p(d,v,"conv1"),conv2:p(v,m,"conv2"),conv3:p(m,g,"conv3"),conv4:p(g,b,"conv4"),conv5:p(b,_,"conv5"),conv6:w?p(_,w,"conv6"):void 0,conv7:y?p(w,y,"conv7"):void 0,conv8:h(y||w||_,5*n,1,"conv8")}}else l=r[0],d=r[1],v=r[2],m=r[3],g=r[4],b=r[5],_=r[6],w=r[7],y=r[8],o={conv0:f(l,d,"conv0"),conv1:f(d,v,"conv1"),conv2:f(v,m,"conv2"),conv3:f(m,g,"conv3"),conv4:f(g,b,"conv4"),conv5:f(b,_,"conv5"),conv6:f(_,w,"conv6"),conv7:f(w,y,"conv7"),conv8:h(y,5*n,1,"conv8")};if(0!==c().length)throw new Error("weights remaing after extract: "+c().length);return{params:o,paramMappings:s}}(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,a,c,u,f,p,l,d,v,m,g,b,_,w,y,x,P,E,M,D,S,I,T,O,B,k,A,L,j=this;return h(this,(function(h){switch(h.label){case 0:return r=e.width,i=e.height,a=Math.max(r,i),c=a/r,u=a/i,f=t.shape[1],p=this.config.anchors.length,l=o.lub((function(){var e=t.reshape([f,f,p,j.boxEncodingSize]);return[e.slice([0,0,0,0],[f,f,p,4]),e.slice([0,0,0,4],[f,f,p,1]),j.withClassScores?o.XAC(e.slice([0,0,0,5],[f,f,p,j.config.classes.length]),3):o.iD$(0)]})),d=l[0],v=l[1],m=l[2],g=[],[4,v.array()];case 1:return b=h.sent(),[4,d.array()];case 2:_=h.sent(),w=0,h.label=3;case 3:if(!(w<f))return[3,12];y=0,h.label=4;case 4:if(!(y<f))return[3,11];x=0,h.label=5;case 5:return x<p?(P=C(b[w][y][x][0]),!n||P>n?(E=(y+C(_[w][y][x][0]))/f*c,M=(w+C(_[w][y][x][1]))/f*u,D=Math.exp(_[w][y][x][2])*this.config.anchors[x].x/f*c,S=Math.exp(_[w][y][x][3])*this.config.anchors[x].y/f*u,I=E-D/2,T=M-S/2,O={row:w,col:y,anchor:x},this.withClassScores?[4,this.extractPredictedClass(m,O)]:[3,7]):[3,9]):[3,10];case 6:return L=h.sent(),[3,8];case 7:L={classScore:1,label:0},h.label=8;case 8:k=(B=L).classScore,A=B.label,g.push(s({box:new F(I,T,I+D,T+S),score:P,classScore:P*k,label:A},O)),h.label=9;case 9:return x++,[3,5];case 10:return y++,[3,4];case 11:return w++,[3,3];case 12:return d.dispose(),v.dispose(),m.dispose(),[2,g]}}))}))},e.prototype.extractPredictedClass=function(t,e){return u(this,void 0,void 0,(function(){var n,r,o,i;return h(this,(function(a){switch(a.label){case 0:return n=e.row,r=e.col,o=e.anchor,[4,t.array()];case 1:return i=a.sent(),[2,Array(this.config.classes.length).fill(0).map((function(t,e){return i[n][r][o][e]})).map((function(t,e){return{classScore:t,label:e}})).reduce((function(t,e){return t.classScore>e.classScore?t:e}))]}}))}))},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(yt),He=function(t){function e(e){void 0===e&&(e=!0);var n=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:Te,meanRgb:Ce}:{anchors:Ie,withClassScores:!0});return t.call(this,n)||this}return c(e,t),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return u(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map((function(t){return new D(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})}))]}}))}))},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(Ne);var We=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return c(e,t),e}(Re),ze=function(){function t(){}return t.prototype.then=function(t){return u(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[n.sent()])]}}))}))},t.prototype.run=function(){return u(this,void 0,void 0,(function(){return h(this,(function(t){throw new Error("ComposableTask - run is not implemented")}))}))},t}();function Ue(t,e){var n={descriptor:e};return Object.assign({},t,n)}function Xe(t,e,n,r,i){return void 0===i&&(i=function(t){return t.alignedRect}),u(this,void 0,void 0,(function(){var a,c,s,u,f;return h(this,(function(h){switch(h.label){case 0:return a=t.map((function(t){return Gt(t)?i(t):t.detection})),(s=r)?[3,5]:e instanceof o.esB?[4,vt(e,a)]:[3,2];case 1:return u=h.sent(),[3,4];case 2:return[4,dt(e,a)];case 3:u=h.sent(),h.label=4;case 4:s=u,h.label=5;case 5:return[4,n(c=s)];case 6:return f=h.sent(),c.forEach((function(t){return t instanceof o.esB&&t.dispose()})),[2,f]}}))}))}function Ye(t,e,n,r,o){return u(this,void 0,void 0,(function(){var i=this;return h(this,(function(a){return[2,Xe([t],e,(function(t){return u(i,void 0,void 0,(function(){return h(this,(function(e){return[2,n(t[0])]}))}))}),r,o)]}))}))}function Ge(t){var e=Bt(t),n=e.extractWeights,r=e.getRemainingWeights,i=[],a=function(t,e){var n=Dt(t,e),r=St(t,e);function i(n,r){var i=o.RRF(t(n));return e.push({paramPath:r}),i}function a(t,e,r){return void 0===r&&(r=!1),{conv1:n(t[0],t[1],3,e+"/conv1"),prelu1_alpha:i(t[1],e+"/prelu1_alpha"),conv2:n(t[1],t[2],3,e+"/conv2"),prelu2_alpha:i(t[2],e+"/prelu2_alpha"),conv3:n(t[2],t[3],r?2:3,e+"/conv3"),prelu3_alpha:i(t[3],e+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=a([3,10,16,32],"pnet"),e=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return s(s({},t),{conv4_1:e,conv4_2:r})},extractRNetParams:function(){var t=a([3,28,48,64],"rnet",!0),e=r(576,128,"rnet/fc1"),n=i(128,"rnet/prelu4_alpha"),o=r(128,2,"rnet/fc2_1"),c=r(128,4,"rnet/fc2_2");return s(s({},t),{fc1:e,prelu4_alpha:n,fc2_1:o,fc2_2:c})},extractONetParams:function(){var t=a([3,32,64,64],"onet"),e=n(64,128,2,"onet/conv4"),o=i(128,"onet/prelu4_alpha"),c=r(1152,256,"onet/fc1"),u=i(256,"onet/prelu5_alpha"),h=r(256,2,"onet/fc2_1"),f=r(256,4,"onet/fc2_2"),p=r(256,10,"onet/fc2_3");return s(s({},t),{conv4:e,prelu4_alpha:o,fc1:c,prelu5_alpha:u,fc2_1:h,fc2_2:f,fc2_3:p})}}}(n,i),c=a.extractPNetParams,u=a.extractRNetParams,h=a.extractONetParams,f=c(),p=u(),l=h();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:f,rnet:p,onet:l},paramMappings:i}}function Ve(t){var e=[],n=function(t,e){var n=Ot(t,e);function r(t){return{filters:n(t+"/weights",4,t+"/filters"),bias:n(t+"/bias",1)}}function o(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}function i(t){return n(t,1)}function a(t){return{conv1:r(t+"/conv1"),prelu1_alpha:i(t+"/prelu1_alpha"),conv2:r(t+"/conv2"),prelu2_alpha:i(t+"/prelu2_alpha"),conv3:r(t+"/conv3"),prelu3_alpha:i(t+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=a("pnet"),e=r("pnet/conv4_1"),n=r("pnet/conv4_2");return s(s({},t),{conv4_1:e,conv4_2:n})},extractRNetParams:function(){var t=a("rnet"),e=o("rnet/fc1"),n=i("rnet/prelu4_alpha"),r=o("rnet/fc2_1"),c=o("rnet/fc2_2");return s(s({},t),{fc1:e,prelu4_alpha:n,fc2_1:r,fc2_2:c})},extractONetParams:function(){var t=a("onet"),e=r("onet/conv4"),n=i("onet/prelu4_alpha"),c=o("onet/fc1"),u=i("onet/prelu5_alpha"),h=o("onet/fc2_1"),f=o("onet/fc2_2"),p=o("onet/fc2_3");return s(s({},t),{conv4:e,prelu4_alpha:n,fc1:c,prelu5_alpha:u,fc2_1:h,fc2_2:f,fc2_3:p})}}}(t,e),r=n.extractPNetParams,o=n.extractRNetParams,i=n.extractONetParams,a=r(),c=o(),u=i();return Mt(t,e),{params:{pnet:a,rnet:c,onet:u},paramMappings:e}}function $e(t,e){var n=e[0],r=e[1];return{height:Math.floor(n*t),width:Math.floor(r*t)}}var Je=function(t){function e(e,n,r,o){return t.call(this,{left:e,top:n,right:r,bottom:o},!0)||this}return c(e,t),e}(E);function Ke(t){return o.lub((function(){return o.dC7(o.luU(t,o.iD$(127.5)),o.iD$(.0078125))}))}function Qe(t,e){return o.lub((function(){return o.IHx(o.UYe(t),o.dC7(e,o.W76(o.UYe(o.W76(t)))))}))}function qe(t,e,n){return void 0===n&&(n=!1),o.lub((function(){var r=Ft(t,e.conv1,"valid");return r=Qe(r,e.prelu1_alpha),r=Qe(r=Ft(r=o._sB(r,n?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),r=Qe(r=Ft(r=n?r:o._sB(r,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)}))}function Ze(t,e,n,r,i){i.stage1=[];var a=e.map((function(e){return o.lub((function(){var n={scale:e},i=function(t,e){return o.lub((function(){var n=$e(e,t.shape.slice(1)),r=n.height,i=n.width,a=Ke(o.BHj.resizeBilinear(t,[r,i]));return o.p4s(a,[0,2,1,3])}))}(t,e),a=Date.now(),c=function(t,e){return o.lub((function(){var n=qe(t,e,!0),r=Ft(n,e.conv4_1,"valid"),i=o.dt4(o.Fp7(r,3),3);return{prob:o.XAC(o.luU(r,i),3),regions:Ft(n,e.conv4_2,"valid")}}))}(i,r),s=c.prob,u=c.regions;return n.pnet=Date.now()-a,{scoresTensor:o.HHK(o.HHK(s,3)[1])[0],regionsTensor:o.HHK(u)[0],scale:e,statsForScale:n}}))})).map((function(t){var e=t.scoresTensor,r=t.regionsTensor,o=t.scale,a=t.statsForScale,c=function(t,e,n,r){for(var o=[],i=t.arraySync(),a=0;a<t.shape[0];a++)for(var c=0;c<t.shape[1];c++)i[a][c]>=r&&o.push(new P(c,a));return o.map((function(t){var r=new F(Math.round((2*t.y+1)/n),Math.round((2*t.x+1)/n),Math.round((2*t.y+12)/n),Math.round((2*t.x+12)/n)),o=i[t.y][t.x],a=e.arraySync();return{cell:r,score:o,region:new Je(a[t.y][t.x][0],a[t.y][t.x][1],a[t.y][t.x][2],a[t.y][t.x][3])}}))}(e,r,o,n);if(e.dispose(),r.dispose(),!c.length)return i.stage1.push(a),[];var s=Date.now(),u=I(c.map((function(t){return t.cell})),c.map((function(t){return t.score})),.5);return a.nms=Date.now()-s,a.numBoxes=u.length,i.stage1.push(a),u.map((function(t){return c[t]}))})).reduce((function(t,e){return t.concat(e)}),[]),c=[],s=[];if(a.length>0){var u=Date.now(),h=I(a.map((function(t){return t.cell})),a.map((function(t){return t.score})),.7);i.stage1_nms=Date.now()-u,s=h.map((function(t){return a[t].score})),c=h.map((function(t){return a[t]})).map((function(t){var e=t.cell,n=t.region;return new F(e.left+n.left*e.width,e.top+n.top*e.height,e.right+n.right*e.width,e.bottom+n.bottom*e.height).toSquare().round()}))}return{boxes:c,scores:s}}function tn(t,e,n){var r=n.width,i=n.height;return u(this,void 0,void 0,(function(){var n,a,c,s=this;return h(this,(function(f){switch(f.label){case 0:return n=Z(t),[4,Promise.all(e.map((function(e){return u(s,void 0,void 0,(function(){var r,o,i,a,c,s,u,f;return h(this,(function(h){return r=e.padAtBorders(t.height,t.width),o=r.y,i=r.ey,a=r.x,c=r.ex,s=a-1,u=o-1,f=n.getImageData(s,u,c-s,i-u),[2,Q.isNodejs()?ut(f):createImageBitmap(f)]}))}))})))];case 1:return a=f.sent(),c=[],a.forEach((function(t){var e=Z(st({width:r,height:i}));e.drawImage(t,0,0,r,i);for(var n=e.getImageData(0,0,r,i).data,o=[],a=0;a<n.length;a+=4)o.push(n[a+2]),o.push(n[a+1]),o.push(n[a]);c.push(o)})),[2,c.map((function(t){return o.lub((function(){return Ke(o.p4s(o.yXz(t,[1,r,i,3]),[0,2,1,3]).toFloat())}))}))]}}))}))}function en(t,e,n,r,i){return u(this,void 0,void 0,(function(){var a,c,s,u,f,p,l,d,v,m,g,b,_,w;return h(this,(function(h){switch(h.label){case 0:return a=Date.now(),[4,tn(t,e,{width:24,height:24})];case 1:return c=h.sent(),i.stage2_extractImagePatches=Date.now()-a,a=Date.now(),s=c.map((function(t){var e=function(t,e){return o.lub((function(){var n=qe(t,e),r=Qe(Rt(o.XLQ(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu4_alpha),i=Rt(r,e.fc2_1),a=o.dt4(o.Fp7(i,1),1),c=o.XAC(o.luU(i,a),1),s=Rt(r,e.fc2_2);return{scores:o.HHK(c,1)[1],regions:s}}))}(t,r);return t.dispose(),e})),i.stage2_rnet=Date.now()-a,u=s.length>1?o.zoF(s.map((function(t){return t.scores}))):s[0].scores,l=(p=Array).from,[4,u.data()];case 2:return f=l.apply(p,[h.sent()]),u.dispose(),d=f.map((function(t,e){return{score:t,idx:e}})).filter((function(t){return t.score>n})).map((function(t){return t.idx})),v=d.map((function(t){return e[t]})),m=d.map((function(t){return f[t]})),g=[],b=[],v.length>0&&(a=Date.now(),_=I(v,m,.7),i.stage2_nms=Date.now()-a,w=_.map((function(t){var e=s[d[t]].regions.arraySync();return new Je(e[0][0],e[0][1],e[0][2],e[0][3])})),b=_.map((function(t){return m[t]})),g=_.map((function(t,e){return v[t].calibrate(w[e])}))),s.forEach((function(t){t.regions.dispose(),t.scores.dispose()})),[2,{boxes:g,scores:b}]}}))}))}function nn(t,e,n,r,i){return u(this,void 0,void 0,(function(){var a,c,s,u,f,p,l,d,v,m,g,b,_,w,y;return h(this,(function(h){switch(h.label){case 0:return a=Date.now(),[4,tn(t,e,{width:48,height:48})];case 1:return c=h.sent(),i.stage3_extractImagePatches=Date.now()-a,a=Date.now(),s=c.map((function(t){var e=function(t,e){return o.lub((function(){var n=qe(t,e);n=Qe(n=Ft(n=o._sB(n,[2,2],[2,2],"same"),e.conv4,"valid"),e.prelu4_alpha);var r=Qe(Rt(o.XLQ(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu5_alpha),i=Rt(r,e.fc2_1),a=o.dt4(o.Fp7(i,1),1),c=o.XAC(o.luU(i,a),1),s=Rt(r,e.fc2_2),u=Rt(r,e.fc2_3);return{scores:o.HHK(c,1)[1],regions:s,points:u}}))}(t,r);return t.dispose(),e})),i.stage3_onet=Date.now()-a,u=s.length>1?o.zoF(s.map((function(t){return t.scores}))):s[0].scores,l=(p=Array).from,[4,u.data()];case 2:return f=l.apply(p,[h.sent()]),u.dispose(),d=f.map((function(t,e){return{score:t,idx:e}})).filter((function(t){return t.score>n})).map((function(t){return t.idx})),v=d.map((function(t){var e=s[t].regions.arraySync();return new Je(e[0][0],e[0][1],e[0][2],e[0][3])})),m=d.map((function(t,n){return e[t].calibrate(v[n])})),g=d.map((function(t){return f[t]})),b=[],_=[],w=[],m.length>0&&(a=Date.now(),y=I(m,g,.7,!1),i.stage3_nms=Date.now()-a,b=y.map((function(t){return m[t]})),_=y.map((function(t){return g[t]})),w=y.map((function(t,e){return Array(5).fill(0).map((function(n,r){var o=s[t].points.arraySync();return new P(o[0][r]*(b[e].width+1)+b[e].left,o[0][r+5]*(b[e].height+1)+b[e].top)}))}))),s.forEach((function(t){t.regions.dispose(),t.scores.dispose(),t.points.dispose()})),[2,{boxes:b,scores:_,points:w}]}}))}))}var rn=function(t){function e(){return t.call(this,"Mtcnn")||this}return c(e,t),e.prototype.load=function(e){return u(this,void 0,void 0,(function(){return h(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]}))}))},e.prototype.loadFromDisk=function(e){return u(this,void 0,void 0,(function(){return h(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]}))}))},e.prototype.forwardInput=function(t,e){return void 0===e&&(e={}),u(this,void 0,void 0,(function(){var n,r,i,a,c,s,u,f,p,l,d,v,m,g,b,_,w,y,x,E,F;return h(this,(function(h){switch(h.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=t.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},a=Date.now(),c=o.lub((function(){return t=o.dt4(o.Xhn.fromPixels(r)).toFloat(),o.lub((function(){return o.knu(o.HHK(t,3).reverse(),3)}));var t})),s=function(t){return c.dispose(),i.total=Date.now()-a,t},u=c.shape.slice(1),f=u[0],p=u[1],l=new be(e),d=l.minFaceSize,v=l.scaleFactor,m=l.maxNumScales,g=l.scoreThresholds,b=l.scaleSteps,_=(b||function(t,e,n){for(var r=n[0],o=n[1],i=12/t,a=[],c=Math.min(r,o)*i,s=0;c>=12;)a.push(i*Math.pow(e,s)),c*=e,s+=1;return a}(d,v,[f,p])).filter((function(t){var e=$e(t,[f,p]);return Math.min(e.width,e.height)>12})).slice(0,m),i.scales=_,i.pyramid=_.map((function(t){return $e(t,[f,p])})),w=Date.now(),[4,Ze(c,_,g[0],n.pnet,i)];case 1:return y=h.sent(),i.total_stage1=Date.now()-w,y.boxes.length?(i.stage2_numInputBoxes=y.boxes.length,w=Date.now(),[4,en(r,y.boxes,g[1],n.rnet,i)]):[2,s({results:[],stats:i})];case 2:return x=h.sent(),i.total_stage2=Date.now()-w,x.boxes.length?(i.stage3_numInputBoxes=x.boxes.length,w=Date.now(),[4,nn(r,x.boxes,g[2],n.onet,i)]):[2,s({results:[],stats:i})];case 3:return E=h.sent(),i.total_stage3=Date.now()-w,F=E.boxes.map((function(t,e){return Vt(H({},new D(E.scores[e],new O(t.left/p,t.top/f,t.width/p,t.height/f),{height:f,width:p})),new k(E.points[e].map((function(e){return e.sub(new P(t.left,t.top)).div(new P(t.width,t.height))})),{width:t.width,height:t.height}))})),[2,s({results:F,stats:i})]}}))}))},e.prototype.forward=function(t,e){return void 0===e&&(e={}),u(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,lt(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent().results]}}))}))},e.prototype.forwardWithStats=function(t,e){return void 0===e&&(e={}),u(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,lt(t)];case 1:return[2,n.apply(this,[r.sent(),e])]}}))}))},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Ve(t)},e.prototype.extractParams=function(t){return Ge(t)},e}(yt),on=[new P(1.603231,2.094468),new P(6.041143,7.080126),new P(2.882459,3.518061),new P(4.266906,5.178857),new P(9.041765,10.66308)],an=[117.001,114.697,97.404],cn=function(t){function e(){var e={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:on,meanRgb:an,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t.call(this,e)||this}return c(e,t),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return u(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map((function(t){return new D(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})}))]}}))}))},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(Ne),sn={ssdMobilenetv1:new De,tinyFaceDetector:new cn,tinyYolov2:new He,mtcnn:new rn,faceLandmark68Net:new ie,faceLandmark68TinyNet:new ce,faceRecognitionNet:new me,faceExpressionNet:new Ut,ageGenderNet:new re};function un(t,e){var n={age:e};return Object.assign({},t,n)}var hn=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.extractedFaces=r,o}return c(e,t),e}(ze),fn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.run=function(){return u(this,void 0,void 0,(function(){var t,e,n=this;return h(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Xe(t=r.sent(),this.input,(function(t){return u(n,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,Promise.all(t.map((function(t){return sn.faceExpressionNet.predictExpressions(t)})))];case 1:return[2,e.sent()]}}))}))}),this.extractedFaces)];case 2:return e=r.sent(),[2,t.map((function(t,n){return Xt(t,e[n])}))]}}))}))},e.prototype.withAgeAndGender=function(){return new mn(this,this.input)},e}(hn),pn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.run=function(){return u(this,void 0,void 0,(function(){var t,e;return h(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,Ye(t,this.input,(function(t){return sn.faceExpressionNet.predictExpressions(t)}),this.extractedFaces)]:[2];case 2:return e=n.sent(),[2,Xt(t,e)]}}))}))},e.prototype.withAgeAndGender=function(){return new gn(this,this.input)},e}(hn),ln=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.withAgeAndGender=function(){return new bn(this,this.input)},e.prototype.withFaceDescriptors=function(){return new yn(this,this.input)},e}(fn),dn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.withAgeAndGender=function(){return new _n(this,this.input)},e.prototype.withFaceDescriptor=function(){return new xn(this,this.input)},e}(pn),vn=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.extractedFaces=r,o}return c(e,t),e}(ze),mn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.run=function(){return u(this,void 0,void 0,(function(){var t,e,n=this;return h(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,Xe(t=r.sent(),this.input,(function(t){return u(n,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,Promise.all(t.map((function(t){return sn.ageGenderNet.predictAgeAndGender(t)})))];case 1:return[2,e.sent()]}}))}))}),this.extractedFaces)];case 2:return e=r.sent(),[2,t.map((function(t,n){var r=e[n],o=r.age;return un(ge(t,r.gender,r.genderProbability),o)}))]}}))}))},e.prototype.withFaceExpressions=function(){return new fn(this,this.input)},e}(vn),gn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.run=function(){return u(this,void 0,void 0,(function(){var t,e,n,r,o;return h(this,(function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(t=i.sent())?[4,Ye(t,this.input,(function(t){return sn.ageGenderNet.predictAgeAndGender(t)}),this.extractedFaces)]:[2];case 2:return e=i.sent(),n=e.age,r=e.gender,o=e.genderProbability,[2,un(ge(t,r,o),n)]}}))}))},e.prototype.withFaceExpressions=function(){return new pn(this,this.input)},e}(vn),bn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.withFaceExpressions=function(){return new ln(this,this.input)},e.prototype.withFaceDescriptors=function(){return new yn(this,this.input)},e}(mn),_n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.withFaceExpressions=function(){return new dn(this,this.input)},e.prototype.withFaceDescriptor=function(){return new xn(this,this.input)},e}(gn),wn=function(t){function e(e,n){var r=t.call(this)||this;return r.parentTask=e,r.input=n,r}return c(e,t),e}(ze),yn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.run=function(){return u(this,void 0,void 0,(function(){var t;return h(this,(function(e){switch(e.label){case 0:return[4,this.parentTask];case 1:return[4,Xe(t=e.sent(),this.input,(function(t){return Promise.all(t.map((function(t){return sn.faceRecognitionNet.computeFaceDescriptor(t)})))}),null,(function(t){return t.landmarks.align(null,{useDlibAlignment:!0})}))];case 2:return[2,e.sent().map((function(e,n){return Ue(t[n],e)}))]}}))}))},e.prototype.withFaceExpressions=function(){return new ln(this,this.input)},e.prototype.withAgeAndGender=function(){return new bn(this,this.input)},e}(wn),xn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.run=function(){return u(this,void 0,void 0,(function(){var t,e;return h(this,(function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,Ye(t,this.input,(function(t){return sn.faceRecognitionNet.computeFaceDescriptor(t)}),null,(function(t){return t.landmarks.align(null,{useDlibAlignment:!0})}))]:[2];case 2:return e=n.sent(),[2,Ue(t,e)]}}))}))},e.prototype.withFaceExpressions=function(){return new dn(this,this.input)},e.prototype.withAgeAndGender=function(){return new _n(this,this.input)},e}(wn),Pn=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.useTinyLandmarkNet=r,o}return c(e,t),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?sn.faceLandmark68TinyNet:sn.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(ze),En=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.run=function(){return u(this,void 0,void 0,(function(){var t,e,n,r,i,a=this;return h(this,(function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return t=c.sent(),e=t.map((function(t){return t.detection})),this.input instanceof o.esB?[4,vt(this.input,e)]:[3,3];case 2:return r=c.sent(),[3,5];case 3:return[4,dt(this.input,e)];case 4:r=c.sent(),c.label=5;case 5:return n=r,[4,Promise.all(n.map((function(t){return a.landmarkNet.detectLandmarks(t)})))];case 6:return i=c.sent(),n.forEach((function(t){return t instanceof o.esB&&t.dispose()})),[2,t.map((function(t,e){return Vt(t,i[e])}))]}}))}))},e.prototype.withFaceExpressions=function(){return new ln(this,this.input)},e.prototype.withAgeAndGender=function(){return new bn(this,this.input)},e.prototype.withFaceDescriptors=function(){return new yn(this,this.input)},e}(Pn),Fn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.run=function(){return u(this,void 0,void 0,(function(){var t,e,n,r,i;return h(this,(function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return(t=a.sent())?(e=t.detection,this.input instanceof o.esB?[4,vt(this.input,[e])]:[3,3]):[2];case 2:return r=a.sent(),[3,5];case 3:return[4,dt(this.input,[e])];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return i=a.sent(),n.forEach((function(t){return t instanceof o.esB&&t.dispose()})),[2,Vt(t,i)]}}))}))},e.prototype.withFaceExpressions=function(){return new dn(this,this.input)},e.prototype.withAgeAndGender=function(){return new _n(this,this.input)},e.prototype.withFaceDescriptor=function(){return new xn(this,this.input)},e}(Pn),Mn=function(t){function e(e,n){void 0===n&&(n=new Me);var r=t.call(this)||this;return r.input=e,r.options=n,r}return c(e,t),e}(ze),Dn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.run=function(){return u(this,void 0,void 0,(function(){var t,e,n,r;return h(this,(function(o){switch(o.label){case 0:return e=(t=this).input,(n=t.options)instanceof be?[4,sn.mtcnn.forward(e,n)]:[3,2];case 1:return[2,o.sent().map((function(t){return t.detection}))];case 2:if(!(r=n instanceof We?function(t){return sn.tinyFaceDetector.locateFaces(t,n)}:n instanceof Me?function(t){return sn.ssdMobilenetv1.locateFaces(t,n)}:n instanceof Re?function(t){return sn.tinyYolov2.locateFaces(t,n)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(e)]}}))}))},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise((function(e){return u(t,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t.map((function(t){return H({},t)})))]}}))}))}))},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new En(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new fn(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new mn(this.runAndExtendWithFaceDetections(),this.input)},e}(Mn);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}c(e,t),e.prototype.run=function(){return u(this,void 0,void 0,(function(){var t,e;return h(this,(function(n){switch(n.label){case 0:return[4,new Dn(this.input,this.options)];case 1:return t=n.sent(),e=t[0],t.forEach((function(t){t.score>e.score&&(e=t)})),[2,e]}}))}))},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise((function(e){return u(t,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t?H({},t):void 0)]}}))}))}))},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new Fn(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new pn(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new gn(this.runAndExtendWithFaceDetection(),this.input)}}(Mn);function Sn(t,e){return void 0===e&&(e=new Me),new Dn(t,e)}!function(){function t(t,e){void 0===e&&(e=.6),this._distanceThreshold=e;var n=Array.isArray(t)?t:[t];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,o=function(){return"person "+r++};this._labeledDescriptors=n.map((function(t){if(t instanceof R)return t;if(t instanceof Float32Array)return new R(o(),[t]);if(t.descriptor&&t.descriptor instanceof Float32Array)return new R(o(),[t.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(t,e){return e.map((function(e){return function(t,e){if(t.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(t),r=Array.from(e);return Math.sqrt(n.map((function(t,e){return t-r[e]})).reduce((function(t,e){return t+Math.pow(e,2)}),0))}(e,t)})).reduce((function(t,e){return t+e}),0)/(e.length||1)},t.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map((function(n){var r=n.descriptors,o=n.label;return new L(o,e.computeMeanDistance(t,r))})).reduce((function(t,e){return t.distance<e.distance?t:e}))},t.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new L("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map((function(t){return t.toJSON()}))}},t.fromJSON=function(e){return new t(e.labeledDescriptors.map((function(t){return R.fromJSON(t)})),e.distanceThreshold)}}();function In(t,e){var n=new p(e.width,e.height),r=n.width,o=n.height;if(r<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:o}));if(Array.isArray(t))return t.map((function(t){return In(t,{width:r,height:o})}));if(Gt(t)){var i=t.detection.forSize(r,o),a=t.unshiftedLandmarks.forSize(i.box.width,i.box.height);return Vt(H(t,i),a)}return N(t)?H(t,t.detection.forSize(r,o)):t instanceof B||t instanceof D?t.forSize(r,o):t}},34038:function(t,e,n){function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(s){o=!0,i=s}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}}(t,e)||function(t,e){if(t){if("string"===typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(e,{Z:function(){return o}})}}]);